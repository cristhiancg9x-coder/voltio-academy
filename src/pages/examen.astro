---
// src/pages/examen.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import ExamInterface from '../components/ui/ExamInterface.jsx';
---

<BaseLayout title="Simulador CNE" description="Examen de certificación para técnicos">
  
  <div id="exam-wrapper" class="hidden py-16 mt-10 px-4">
      <ExamInterface client:only="react" />
  </div>

  <div id="loader" class="min-h-[60vh] flex flex-col items-center justify-center">
    <div class="w-12 h-12 border-4 border-volt-primary border-t-transparent rounded-full animate-spin mb-4"></div>
    <p class="text-slate-500 text-sm animate-pulse">Verificando credenciales...</p>
  </div>

</BaseLayout>

<script>
    import { supabase } from '../lib/supabase';

    // EL GUARDIA DE SEGURIDAD (Client-Side Protection)
    async function checkAccess() {
        const { data: { session } } = await supabase.auth.getSession();

        if (!session) {
            window.location.href = '/login';
        } else {
            const loader = document.getElementById('loader');
            const wrapper = document.getElementById('exam-wrapper');
            
            if(loader && wrapper) {
                loader.classList.add('hidden');
                wrapper.classList.remove('hidden');
                wrapper.classList.add('animate-fade-in'); 
            }
        }
    }
    checkAccess();
</script>