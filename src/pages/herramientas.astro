---
// src/pages/herramientas.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import { Calculator, Zap, Divide, X, Activity } from 'lucide-react';
---

<BaseLayout title="Calculadoras Eléctricas" description="Herramientas de cálculo para electricistas: Ley de Ohm, Caída de Tensión y más.">
  
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 mt-10">
    
    {/* HEADER */}
    <div class="text-center mb-16">
        <span class="text-volt-primary font-mono text-xs tracking-widest uppercase mb-2 block">Toolbox V.1.0</span>
        <h1 class="text-4xl md:text-6xl font-display font-bold text-white mb-6">
            Centro de <span class="text-transparent bg-clip-text bg-gradient-to-r from-volt-primary to-volt-secondary">Cálculo</span>
        </h1>
        <p class="text-slate-400 max-w-2xl mx-auto text-lg">
            Deja de adivinar. Usa nuestras herramientas de precisión para dimensionar circuitos y protecciones según norma.
        </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        {/* COLUMNA IZQUIERDA: Menú de Herramientas */}
        <div class="space-y-4">
            <div class="p-4 rounded-xl bg-volt-primary/10 border border-volt-primary/50 text-white flex items-center gap-4 cursor-pointer shadow-[0_0_15px_rgba(0,240,255,0.2)]">
                <Activity className="w-6 h-6 text-volt-primary" />
                <div class="text-left">
                    <h3 class="font-bold">Ley de Ohm</h3>
                    <p class="text-xs text-slate-400">Voltaje, Corriente y Resistencia</p>
                </div>
            </div>
            
            {/* Herramientas Futuras (Deshabilitadas visualmente) */}
            <div class="p-4 rounded-xl bg-volt-dark/50 border border-white/5 text-slate-500 flex items-center gap-4 opacity-60 cursor-not-allowed">
                <Zap className="w-6 h-6" />
                <div class="text-left">
                    <h3 class="font-bold">Caída de Tensión</h3>
                    <p class="text-xs text-slate-600">Próximamente</p>
                </div>
            </div>
            <div class="p-4 rounded-xl bg-volt-dark/50 border border-white/5 text-slate-500 flex items-center gap-4 opacity-60 cursor-not-allowed">
                <Divide className="w-6 h-6" />
                <div class="text-left">
                    <h3 class="font-bold">Consumo (kWh)</h3>
                    <p class="text-xs text-slate-600">Próximamente</p>
                </div>
            </div>
        </div>

        {/* COLUMNA DERECHA: La Calculadora Activa */}
        <div class="lg:col-span-2">
            <div class="bg-volt-dark/80 border border-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-12 relative overflow-hidden">
                
                {/* Fondo decorativo */}
                <div class="absolute top-0 right-0 p-12 opacity-5 pointer-events-none">
                    <Calculator className="w-64 h-64 text-white -rotate-12" />
                </div>

                <h2 class="text-2xl font-display font-bold text-white mb-6 flex items-center gap-2">
                    <Activity className="w-6 h-6 text-volt-primary" /> Calculadora Ley de Ohm
                </h2>

                <p class="text-slate-400 mb-8 text-sm">
                    Ingresa dos valores conocidos para calcular el tercero automáticamente.
                </p>

                {/* INPUTS DE LA CALCULADORA */}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    
                    {/* VOLTAJE (V) */}
                    <div class="relative group">
                        <label class="block text-xs font-bold text-volt-secondary mb-2 uppercase tracking-wider">Voltaje (V)</label>
                        <input type="number" id="input-v" placeholder="Volts" 
                            class="w-full bg-black/50 border border-white/10 text-white p-4 rounded-xl focus:border-volt-secondary focus:ring-1 focus:ring-volt-secondary outline-none transition-all font-mono text-lg"
                        />
                        <div class="absolute top-10 right-4 text-slate-500 font-mono">V</div>
                    </div>

                    {/* INTENSIDAD (I) */}
                    <div class="relative group">
                        <label class="block text-xs font-bold text-volt-primary mb-2 uppercase tracking-wider">Corriente (I)</label>
                        <input type="number" id="input-i" placeholder="Amperios" 
                            class="w-full bg-black/50 border border-white/10 text-white p-4 rounded-xl focus:border-volt-primary focus:ring-1 focus:ring-volt-primary outline-none transition-all font-mono text-lg"
                        />
                        <div class="absolute top-10 right-4 text-slate-500 font-mono">A</div>
                    </div>

                    {/* RESISTENCIA (R) */}
                    <div class="relative group">
                        <label class="block text-xs font-bold text-orange-400 mb-2 uppercase tracking-wider">Resistencia (R)</label>
                        <input type="number" id="input-r" placeholder="Ohmios" 
                            class="w-full bg-black/50 border border-white/10 text-white p-4 rounded-xl focus:border-orange-400 focus:ring-1 focus:ring-orange-400 outline-none transition-all font-mono text-lg"
                        />
                        <div class="absolute top-10 right-4 text-slate-500 font-mono">Ω</div>
                    </div>

                </div>

                {/* BOTONES DE ACCIÓN */}
                <div class="flex gap-4 mb-8">
                    <button id="btn-calc" class="flex-1 py-3 bg-volt-primary text-black font-bold rounded-lg hover:bg-white transition-all shadow-[0_0_20px_rgba(0,240,255,0.3)]">
                        CALCULAR
                    </button>
                    <button id="btn-clear" class="px-6 py-3 border border-white/10 text-slate-300 rounded-lg hover:bg-white/5 transition-all">
                        <X className="w-5 h-5" />
                    </button>
                </div>

                {/* RESULTADO / CONSOLA */}
                <div class="bg-black/80 rounded-xl p-6 border-l-4 border-volt-primary font-mono">
                    <p class="text-xs text-slate-500 mb-2">// Resultado del Sistema:</p>
                    <p id="result-display" class="text-xl md:text-2xl text-white break-words">
                        Esperando datos...
                    </p>
                </div>

            </div>
        </div>

    </div>

  </div>
</BaseLayout>

<script>
    // LÓGICA DE LA CALCULADORA (TypeScript Safe)
    const inputV = document.getElementById('input-v') as HTMLInputElement;
    const inputI = document.getElementById('input-i') as HTMLInputElement;
    const inputR = document.getElementById('input-r') as HTMLInputElement;
    const btnCalc = document.getElementById('btn-calc');
    const btnClear = document.getElementById('btn-clear');
    const display = document.getElementById('result-display');

    if (btnCalc && display) {
        btnCalc.addEventListener('click', () => {
            const v = parseFloat(inputV.value);
            const i = parseFloat(inputI.value);
            const r = parseFloat(inputR.value);

            let result = "";
            let color = "text-white";

            // Lógica de Ohm: V = I * R
            // Caso 1: Calcular Voltaje (tenemos I y R)
            if (isNaN(v) && !isNaN(i) && !isNaN(r)) {
                result = `Voltaje = ${(i * r).toFixed(2)} V`;
                color = "text-volt-secondary";
                inputV.value = (i * r).toFixed(2);
            }
            // Caso 2: Calcular Corriente (tenemos V y R)
            else if (!isNaN(v) && isNaN(i) && !isNaN(r)) {
                if(r === 0) { result = "Error: Cortocircuito (R=0)"; color="text-red-500"; }
                else {
                    result = `Corriente = ${(v / r).toFixed(2)} A`;
                    color = "text-volt-primary";
                    inputI.value = (v / r).toFixed(2);
                }
            }
            // Caso 3: Calcular Resistencia (tenemos V y I)
            else if (!isNaN(v) && !isNaN(i) && isNaN(r)) {
                if(i === 0) { result = "Error: Circuito abierto (I=0)"; color="text-red-500"; }
                else {
                    result = `Resistencia = ${(v / i).toFixed(2)} Ω`;
                    color = "text-orange-400";
                    inputR.value = (v / i).toFixed(2);
                }
            }
            // Error: No hay suficientes datos o hay demasiados
            else {
                result = "Error: Ingresa exactamente 2 valores para calcular el tercero.";
                color = "text-red-400";
            }

            display.innerHTML = `<span class="${color}">${result}</span>`;
            
            // Animación simple
            display.style.opacity = '0.5';
            setTimeout(() => display.style.opacity = '1', 100);
        });
    }

    if (btnClear && display) {
        btnClear.addEventListener('click', () => {
            inputV.value = '';
            inputI.value = '';
            inputR.value = '';
            display.innerHTML = 'Sistema reiniciado. Esperando datos...';
            display.className = 'text-xl md:text-2xl text-white break-words';
        });
    }
</script>