---
// src/pages/aula/[id].astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import VideoPlayer from '../../components/ui/VideoPlayer.jsx';

// YA NO NECESITAMOS getStaticPaths PORQUE ESTAMOS EN MODO SERVER (SSR)
// Astro generará la página al vuelo para cualquier ID.

const { id } = Astro.params;
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://127.0.0.1:8000';

// 1. Pedimos los datos del curso al Backend (Python)
let curso = null;
try {
  const response = await fetch(`${API_URL}/api/curso/${id}/completo`);
  if (response.ok) {
    curso = await response.json();
  }
} catch (error) {
  console.error("Error conectando al backend:", error);
}

// 2. Si el curso no existe en la BD, mandamos a 404
if (!curso || curso.error) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={`Aula: ${curso.title}`} description="Zona de estudio">
  <div class="min-h-screen bg-[#0a0a0a]">
    
    {/* Pasamos los datos REALES de la base de datos al reproductor */}
    <VideoPlayer client:only="react" courseData={curso} courseId={id} />

  </div>
</BaseLayout>